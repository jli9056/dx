<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- 
    Mapping file autogenerated
-->
<hibernate-mapping>
    <class name="com.dixin.hibernate.ProductFactoryorderSummary" catalog="dixin">
    	<subselect>
    		select p.model as model, 
    			   fod.fk_product_id as id,
    			   sum(fod.available_count) as available_count,
    			   sum(fod.quantity) as quantity,
    			   sum(fod.owned_count) as owned_count
    		from product p, factoryorderdetail fod, factoryorder fo
    		where
    		fo.doubleCheck=1
    		and
    		fo.finished=0
    		and
    		fod.fk_factoryorder_id=fo.id
    		and
    		fod.fk_product_id = p.id
    		group by fod.fk_product_id
    	</subselect>
        <id name="id" type="java.lang.Integer">
            <column name="id" />
            <generator class="increment" />
        </id>
        <property name="quantity" type="java.lang.Integer">
            <column name="quantity" not-null="true" />
        </property>
        <property name="availableCount" type="java.lang.Integer">
            <column name="available_count" not-null="true" />
        </property>
        <property name="ownedCount" type="java.lang.Integer">
            <column name="owned_count" not-null="true" />
        </property>
        <property name="deliveredCount"	formula="quantity - owned_count"/>
        <property name="orderedCount"	formula="quantity - available_count"/>
        <property name="model"  type="java.lang.String">
            <column name="model" not-null="true" />
        </property>
    </class>
</hibernate-mapping>
